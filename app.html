{% extends "admin/adminBase.html" %}
{% block title %}Admin ManageTimetable{% endblock %}
{% block content %}
<div class="menu-section">
    <h2>Manage Timetable</h2>

    <form action="{{ url_for('fetch_drive_files') }}" method="GET">
        <button type="submit">Fetch Drive Files</button>
    </form>

    {% if files %}
        <h3>Available Timetables</h3>
        <ul>
        {% for file in files %}
            <li>
                {{ file.name }}
                <a href="{{ file.webViewLink }}" target="_blank">[Open in Drive]</a>
                <button type="button" onclick="previewTimetable('{{ file.id }}')">Preview</button>
            </li>
        {% endfor %}
        </ul>

        <div id="previewArea" style="margin-top:20px; border:1px solid #ccc; padding:10px;">
            <h4>Preview Result</h4>
            <pre id="previewContent">Click a preview button to load timetable...</pre>
        </div>
    {% else %}
        <p>No files found. Please fetch from Google Drive.</p>
    {% endif %}
</div>

<script>
function previewTimetable(fileId) {
    document.getElementById("previewContent").textContent = "Loading...";
    fetch(`/admin/preview_timetable/${fileId}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById("previewContent").textContent = JSON.stringify(data, null, 2);
        })
        .catch(err => {
            document.getElementById("previewContent").textContent = "Error: " + err;
        });
}
</script>
{% endblock %}
