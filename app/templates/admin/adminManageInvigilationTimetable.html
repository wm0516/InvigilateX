{% extends "admin/adminBase.html" %}
{% block title %}Admin ManageInvigilationTimetable{% endblock %}
{% block content %}

<div class="menu-section">
    <h2>Manage Invigilation Timetable</h2>    
    <form method="POST">  

    </form>

    <br><br>
    <h2>List of All Exam Sessions Details</h2>
    <div class="user-table-container">
        <table class="user-data-table">
            <thead>
                <tr>
                    <th>Exam ID</th>
                    <th>Course Details</th>
                    <th>Exam Details</th>
                    <th>Number of Invigilators</th>
                    <th>Invigilator Details</th>
                    <th>Attendance Status</th>
                </tr>
            </thead>

            <tbody>
                {% for exam, grouped in attendances|groupby("report.exam.examId") %}
                    {% set rowspan = grouped|length %}
                    
                    {% for att in grouped %}
                        <tr>
                            {% if loop.first %}
                                <!-- Exam ID -->
                                <td rowspan="{{ rowspan }}" style="text-align:center;">[{{ att.report.exam.examId }}]</td>

                                <!-- Course Details -->
                                <td rowspan="{{ rowspan }}" style="border-bottom:none;">
                                    <table style="border-collapse: collapse;">
                                        <tr>
                                            <td style="font-weight:bold;">Course Name</td>
                                            <td>: {{ att.report.exam.course.courseName }}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Course Code/Section</td>
                                            <td>: {{ att.report.exam.course.courseCodeSection }}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Program Code</td>
                                            <td>: {{ att.report.exam.course.courseDepartment }}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Number of Students</td>
                                            <td>: {{ att.report.exam.course.courseStudent }}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Practical Lecturer</td>
                                            <td>: {{ att.report.exam.course.practicalLecturer.userName }}</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Tutorial Lecturer </td>
                                            <td>: {{ att.report.exam.course.tutorialLecturer.userName }} </td>
                                        </tr>
                                    </table>
                                </td>

                                <!-- Exam Details -->
                                <td rowspan="{{ rowspan }}" style="border-bottom:none;">
                                    <table style="border-collapse: collapse;">
                                        <tr>
                                            <td style="font-weight:bold;">Exam Date</td>
                                            <td>: [{{ att.report.exam.examStartTime.strftime("%Y-%m-%d") }}] - [{{ att.report.exam.examEndTime.strftime("%Y-%m-%d") }}]</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Exam Day</td>
                                            <td>: [{{ att.report.exam.examStartTime.strftime("%A") }}] - [{{ att.report.exam.examEndTime.strftime("%A") }}]</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Exam Time</td>
                                            <td>: [{{ att.report.exam.examStartTime.strftime("%H:%M") }}] - [{{ att.report.exam.examEndTime.strftime("%H:%M") }}]</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Exam Period</td>
                                            <td>: [{{ (att.report.exam.examEndTime - att.report.exam.examStartTime).seconds // 3600 }}h - {{ ((att.report.exam.examEndTime - att.report.exam.examStartTime).seconds % 60) // 3600 }}m]</td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight:bold;">Exam Venue</td>
                                            <td>: [{{ att.report.exam.examNoInvigilator }}]</td>
                                        </tr>
                                    </table>
                                </td>

                                <td rowspan="{{ rowspan }}">[{{ att.report.exam.examNoInvigilator }}]</td>
                            {% endif %}

                            <!-- Invigilator Details (one per row) -->
                            <td>
                                ID     : {{ att.invigilator.userId }} <br>
                                Name   : {{ att.invigilator.userName }} <br>
                                Contact: {{ att.invigilator.userContact }}
                            </td>

                            <!-- Attendance Status (per invigilator) -->
                            <td>{{ att.remark }}</td>
                        </tr>
                    {% endfor %}
                {% endfor %}
            </tbody>    
        </table>
    </div>
</div>

{% endblock %}