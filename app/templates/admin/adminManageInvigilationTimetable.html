{% extends "admin/adminBase.html" %}
{% set show_tabs = false %}
{% set show_upload = false %}
{% set show_dashboard = false %}
{% set show_manual = false %}
{% set show_edit = false %}
{% block title %}Admin ManageInvigilationTimetable{% endblock %}
{% block head_title %}<h2>Manage Invigilation Timetable</h2>{% endblock %}

{% block content %}
<div class="menu-section">
    <h3>List of All Exam Sessions Details</h3>
    <div style="display: flex; gap: 15px; align-items: center;">
        <h4>Exam Status:</h4>
        <div style="display: flex; align-items: center; gap: 5px;">
            <span style="width: 20px; height: 20px; background-color: lightgrey; display: inline-block; border-radius: 4px;"></span>
            <span>Past Exam</span>
        </div>
        <div style="display: flex; align-items: center; gap: 5px;">
            <span style="width: 20px; height: 20px; background-color: #75bdf9; display: inline-block; border-radius: 4px;"></span>
            <span>Upcoming Exam</span>
        </div>
        <div style="display: flex; align-items: center; gap: 5px;">
            <span style="width: 20px; height: 20px; background-color: #dc74f7; display: inline-block; border-radius: 4px;"></span>
            <span>Overnight Exam (Starts Today, Ends Tomorrow)</span>
        </div>
    </div><br>

    <div class="calendar-container">
        {% for date, exams in calendar_data.items() %}
            <div class="calendar-day" data-date="{{ date.isoformat() }}">
                <h3 class="calendar-date">{{ date.strftime("%A, %d %B %Y") }} | <i>[Total Exams: {{ exams|length }}]</i></h3>
                <div class="exam-grid">
                    {% for exam in exams %}
                        <div class="exam-card"
                            style="background-color: {% if exam.is_overnight %}#dc74f7{% elif exam.status %}#75bdf9{% else %}lightgrey{% endif %};">
                            <strong>{{ exam.course_code }}</strong> - <i>{{ exam.course_name }}</i><br>
                            <strong>Venue</strong>: {{ exam.venue }}<br>
                            <strong>Time</strong>: {{ exam.start_time.strftime("%H:%M") }} - {{ exam.end_time.strftime("%H:%M") }}
                            {% if exam.is_overnight %}
                                <span style="font-size: 12px; color: #700;">(Overnight)</span>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const container = document.querySelector(".calendar-container");
  const days = [...container.querySelectorAll(".calendar-day")];
  if (!days.length) return;

  const today = new Date().setHours(0,0,0,0);
  let target = days.find(d => new Date(d.dataset.date) >= today) || days.at(-1);

  container.scrollTo({ top: target.offsetTop, behavior: "smooth" });
});
</script>
{% endblock %}

