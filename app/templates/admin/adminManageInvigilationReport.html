{% extends "admin/adminBase.html" %}
{% set show_tabs = true %}
{% set show_upload = false %}
{% set show_dashboard = true %}
{% set show_manual = false %}
{% block title %}Admin ManageInvigilationReport{% endblock %}
{% block head_title %}<h2>Manage Invigilation Report</h2>{% endblock %}

{% block dashboard_section %}
<!-- Dashboard Form -->
<form id="dashboardForm" action="{{ url_for('admin_manageInvigilationReport') }}" method="POST">
    <div id="dashboardSection" class="function-frame">
        <input type="hidden" name="form_type" value="dashboard">
        <div class="form-left" style="width: 100%">
        </div>
    </div>
</form>
{% endblock %}

{% block content %}
<div class="menu-section">
    <h3>List of Lecturer Invigilation Report</h3>
    <div class="user-table-container">
    <table class="user-data-table">
        <thead>
            <tr>
                <th>Exam ID</th>
                <th>Course Details</th>
                <th>Exam Details</th>
                <th>Number of Invigilators</th>
                <th>Invigilator Details</th>
                <th>Check-in Time</th>
                <th>Check-out Time</th>
                <th>Attendance Status</th>
            </tr>
        </thead>
        <tbody>
            {% for exam, grouped in attendances|groupby("report.exam.examId") %}
                {% set rowspan = grouped|length %}
                {% for att in grouped %}
                    <tr>
                        {% if loop.first %}
                            <!-- Exam ID -->
                            <td rowspan="{{ rowspan }}">[{{ att.report.exam.examId }}]</td>
                        
                            <!-- Course Details -->
                            <td rowspan="{{ rowspan }}">
                                Course Name        : {{ att.report.exam.course.courseName }} <br>
                                Course Code/Section: {{ att.report.exam.course.courseCodeSection }}<br>
                                Number of Students : {{ att.report.exam.course.courseStudent }}
                            </td>

                            <!-- Exam Details -->
                            <td rowspan="{{ rowspan }}">
                                Exam Date   : [{{ att.report.exam.examStartTime.strftime("%Y-%m-%d") }} - {{ att.report.exam.examEndTime.strftime("%Y-%m-%d") }}] <br>      
                                Exam Day    : [{{ att.report.exam.examStartTime.strftime("%A") }} - {{ att.report.exam.examEndTime.strftime("%A") }}] <br>
                                Exam Time   : [{{ att.report.exam.examStartTime.strftime("%H:%M") }} - {{ att.report.exam.examEndTime.strftime("%H:%M") }}] <br>
                                Exam Period : [{{ (att.report.exam.examEndTime - att.report.exam.examStartTime).seconds // 3600 }}h 
                                              {{ ((att.report.exam.examEndTime - att.report.exam.examStartTime).seconds % 60) // 3600 }}m]<br>
                                Exam Venue  : [{{ att.report.exam.examVenue }}]
                            </td>

                            <!-- Number of Invigilators -->
                            <td rowspan="{{ rowspan }}">[{{ att.report.exam.examNoInvigilator }}]</td>
                        {% endif %}

                        <!-- Invigilator Details -->
                        <td>
                            ID     : {{ att.invigilator.userId }} <br>
                            Name   : {{ att.invigilator.userName }} <br>
                            Contact: {{ att.invigilator.userContact }}
                        </td>
                        
                        <!-- Check-in Time -->
                        <td>{{ att.checkIn }}</td>

                        <!-- Check-out Time -->
                        <td>{{ att.checkOut }}</td>

                        <!-- Attendance Status -->
                        <td>{{ att.remark }}</td>
                    </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>

{% endblock %}
