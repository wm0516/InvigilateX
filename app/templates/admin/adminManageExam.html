{% extends "admin/adminBase.html" %}
{% set show_tabs = true %}
{% block title %}Admin ManageExam{% endblock %}
{% block head_title %}<h2>Manage Exam</h2>{% endblock %}

{% block announce_section %}
<!-- Announce Form -->
<form id="announceForm" action="{{ url_for('admin_manageExam') }}" method="POST" enctype="multipart/form-data">
    <div id="announceSection" class="function-frame">
        <input type="hidden" name="form_type" value="announce">
        <div class="form-left" style="width: 100%">
        </div>
    </div>
</form>
{% endblock %}

{% block upload_section %}
<!-- Upload Form -->
<form id="uploadForm" action="{{ url_for('admin_manageExam') }}" method="POST" enctype="multipart/form-data" style="display: none;">
    <div id="uploadSection" class="function-frame">
        <div class="form-left" style="width: 100%">
            <h4 style="text-align: center;">File Upload Section</h4>
            <label for="exam_list">
                <div class="upload-container" id="examUploadContainer">
                    <div class="upload-text">
                        Upload a file with an empty first row. Data should start from columns A to J,<br> 
                        labeled as: ['Date', 'Day', 'Start', 'End', 'Program', 'Course/Sec', 'Practical Lecturer', 'Tutorial Lecturer', 'No of', 'Room']<br><br><br>
                        Click to upload or drag and drop with below file format
                    </div>
                    <div class="file-types">XLSX, XLS, or XLSM</div><br>
                    <!-- Selected file display -->
                    <div id="examSelectedFileName" class="file-name-display"></div>
                </div>
            </label>
            <input type="file" id="exam_list" name="exam_file" accept=".xlsx,.xls,.xlsm" style="display: none;">
            <!-- ðŸ”½ Add this hidden input here -->
            <input type="hidden" name="form_type" value="upload">
            <br>

            <!-- Upload Form Submit -->
            <div class="button-wrapper">
                <button type="submit">Upload Exam</button>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block manual_section %}
<!-- Manual Form -->
<form id="manualForm" action="{{ url_for('admin_manageExam') }}" method="POST" style="display: none;">
    <div id="manualSection" class="function-frame" style="width:100%">
        <h4 style="text-align: center;">Manual Data Entry Section</h4>
        <div class="profile-frame">
            <div class="form-left" style="margin: auto;">
                <label>Exam Start Date & Time</label>
                <div style="display: flex; gap: 2%;">
                    <input type="date" id="startDate" name="startDate" required>
                    <input type="time" id="startTime" name="startTime" required>
                </div><br>

                <label>Exam End Date & Time</label>
                <div style="display: flex; gap: 2%;">
                    <input type="date" id="endDate" name="endDate" required>
                    <input type="time" id="endTime" name="endTime" required>
                </div><br>

                <label>Program Code</label>
                <select name="programCode" id="programCode" required>
                    <option value="" disabled selected>Select Program Code</option>
                    {% for dept in department_data %}
                        <option value="{{ dept.departmentCode }}">
                            [{{ dept.departmentCode }}] {{ dept.departmentName }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-middle" style="margin: auto;">
                <label>Course/Section</label>
                <select name="courseSection" id="courseSection" required>
                    <option value="" disabled selected>Select Course Section</option>
                    {% for course in course_data %}
                        <option value="{{ course.courseCodeSection }}">
                            [{{ course.courseCodeSection }}] - {{ course.courseName }}
                        </option>   
                    {% endfor %}
                </select><br>

                <label>Course Practical Lecturer</label>
                <input type="text" id="practicalLecturer" name="practicalLecturer" readonly><br>

                <label>Course Tutorial Lecturer</label>
                <input type="text" id="tutorialLecturer" name="tutorialLecturer" readonly>
            </div> 

            <div class="form-right" style="margin: auto;">
                <label>Number of Students</label>
                <input type="number" id="student" name="student" readonly><br>

                <label>Venue</label>
                <select name="venue" id="venueSection" required>
                    <option value="" disabled selected>Select Venue</option>
                    {% for venue in venue_data %}
                        <option value="{{ venue.venueNumber }}">
                            [Capacity: {{ venue.venueCapacity }}] - {{ venue.venueNumber }}
                        </option>
                    {% endfor %}
                </select><br>

                <label>Number of Invigilators</label>
                <input type="number" id="invigilatorNo" name="invigilatorNo" value="{{ invigilatorNo_text }}" min="1" step="1" required>    
            </div>
        </div>

        <!-- ðŸ”½ Add this hidden input here -->
        <input type="hidden" name="form_type" value="manual">
        <br>

        <!-- Upload Form Submit -->
        <div class="button-wrapper">
            <button type="submit">Add New Exam</button>
        </div>
    </div>
</form>
{% endblock %}


{% block content %}
<div class="menu-section">
    <h2>List of Exam</h2>
    <div class="user-table-container">
        <table class="user-data-table">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Course Details</th>
                    <th>Exam ID</th>
                    <th>Exam Details</th>
                    <th>Number of Invigilators</th>
                </tr>
            </thead>
            <tbody>
                {% for row in exam_data %}
                    <tr>
                        <td>{{ loop.index }}</td>

                        <!-- Course Details -->
                        <td>
                            Course Name        : {{ row.course.courseName }} <br>
                            Course Code/Section: {{ row.course.courseCodeSection }}<br>
                            Program Code       : {{ row.course.courseDepartment }} <br>
                            Number of Students : {{ row.course.courseStudent }} <br>
                            Practical Lecturer : {{ row.course.practicalLecturer.userName }} <br>
                            Tutorial Lecturer  : {{ row.course.tutorialLecturer.userName }}
                        </td>

                        <td>[{{ row.examId }}]</td>

                        <!-- Exam Details -->
                        <td>
                            Exam Date  : [{{ row.examStartTime.strftime("%Y-%m-%d") }}] - [{{ row.examEndTime.strftime("%Y-%m-%d") }}]<br>      
                            Exam Day   : [{{ row.examStartTime.strftime("%A") }}] - [{{ row.examEndTime.strftime("%A") }}] <br>
                            Exam Time  : [{{ row.examStartTime.strftime("%H:%M") }}] - [{{ row.examEndTime.strftime("%H:%M") }}] <br>
                            Exam Period: [{{ (row.examEndTime - row.examStartTime).seconds // 3600 }}h {{ ((row.examEndTime - row.examStartTime).seconds % 3600) // 60 }}m] <br>
                            Exam Venue : [{{ row.examVenue }}]
                        </td>
                        
                        <td>[{{ row.examNoInvigilator }}]</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}




