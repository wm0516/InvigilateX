{% extends "user/userBase.html" %}
{% block title %}Timetable{% endblock %}
{% block head_title %}
<h2><i>{{ user_department }}</i> - Merge Timetable</h2>
{% endblock %}

{% block content %}
<div class="menu-section">
    <!-- Lecturer Filter -->
    <div> 
        <form method="get" style="display:flex; align-items:center; gap:8px; width: 50%;">
            <label for="lecturer">Select_Lecturer:</label>
            <select name="lecturer" id="lecturer" onchange="this.form.submit()">
                <option value="">All Lecturers</option>
                {% for lecturer in lecturers %}
                    <option value="{{ lecturer }}" {% if lecturer == selected_lecturer %}selected{% endif %}>
                        {{ lecturer }}
                    </option>
                {% endfor %}
            </select>

            {% if selected_lecturer %}
                <button type="button" onclick="window.location.href='{{ url_for('user_mergeTimetable') }}'" style="margin-left: 10px; padding: 4px 8px;">
                    Clear_Filter
                </button>
            {% endif %}
        </form>
    </div>

    <div class="user-table-container">
        <table class="user-data-table" border="1">
            <thead>
                <tr>
                    <th>Day / Time</th>
                    {% for time in ["07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"] %}
                        <th>{{ time }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% set day_colors = {
                    "MON": "#e3f2fd", 
                    "TUE": "#fce4ec", 
                    "WED": "#e8f5e9",  
                    "THU": "#fff3e0",  
                    "FRI": "#ede7f6" 
                } %}
                {% for day in ["MON", "TUE", "WED", "THU", "FRI"] %}
                <tr style="background-color: {{ day_colors[day] }}">
                    <td><strong>{{ day }}</strong><br></td>

                    {% for time in ["07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"] %}
                    <td>
                        {% for row in timetable_rows %}
                            {% if row.classDay == day %}
                                {% set start = row.classTime.split('-')[0].strip() %}
                                {% set end = row.classTime.split('-')[1].strip() %}
                                {% if time >= start and time < end %}
                                    <div style="border:1px solid #ccc; padding:4px; background:#f8f9fa; margin-bottom: 1%;">
                                        <strong>Lecturer</strong>: <i>{{ row.lecturerName }}</i><br>
                                        <strong>Course</strong>:<br><i>{{ row.courseName }}</i><br>
                                        <strong>Class Type</strong>: <i>{{ row.classType }}</i><br>
                                        <strong>Room</strong>: <i>{{ row.classRoom }}</i><br>
                                        <strong>Sections</strong>: <br>
                                        {% for intake, code, section in row.combined %}
                                            <i>{{ intake }} | {{ code }} | {{ section }};</i><br>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    $(document).ready(function() {
        $('#lecturer').select2({
            placeholder: "Type to search...",
            allowClear: true
        });
    });
</script>
{% endblock %}
